/* UT-LINE-01 — Line sensors (A0..A2)
   Pass if we see readable input and reasonable white/black separation.
   Wiring: L=A0, M=A1, R=A2 (3.3V logic), common GND. */

#define L A0
#define M A1
#define R A2

#define ASSERT_OK(c,msg) do{ if(!(c)){ Serial.print("[FAIL] "); Serial.println(msg); ok=false; } }while(0)
void hdr(const char* t){ Serial.println(); Serial.print("===== "); Serial.print(t); Serial.println(" ====="); }
void wait_enter(const char* msg){ Serial.println(msg); while(Serial.available()) Serial.read(); while(!Serial.available()){} while(Serial.available()) Serial.read(); }

void setup(){
  Serial.begin(115200);
  hdr("UT-LINE-01");
  Serial.println("Place sensors on WHITE when asked, then on BLACK tape.");
}

void loop(){
  bool ok=true;
  const int N = 150;

  wait_enter("Put L/M/R over WHITE, press ENTER.");
  long WL=0,WM=0,WR=0;
  for(int i=0;i<N;i++){ WL+=analogRead(L); WM+=analogRead(M); WR+=analogRead(R); delay(2); }
  int wL=WL/N, wM=WM/N, wR=WR/N;

  wait_enter("Now put L/M/R over BLACK tape, press ENTER.");
  long BL=0,BM=0,BR=0;
  for(int i=0;i<N;i++){ BL+=analogRead(L); BM+=analogRead(M); BR+=analogRead(R); delay(2); }
  int bL=BL/N, bM=BM/N, bR=BR/N;

  int dL=bL-wL, dM=bM-wM, dR=bR-wR;

  Serial.print("WHITE means L/M/R = "); Serial.print(wL); Serial.print("/"); Serial.print(wM); Serial.print("/"); Serial.println(wR);
  Serial.print("BLACK means L/M/R = "); Serial.print(bL); Serial.print("/"); Serial.print(bM); Serial.print("/"); Serial.println(bR);
  Serial.print("Separation  L/M/R = "); Serial.print(dL); Serial.print("/"); Serial.print(dM); Serial.print("/"); Serial.println(dR);

  ASSERT_OK((wL>0||wM>0||wR>0), "All ADC zeros — check power/wiring");
  ASSERT_OK(dL>120, "L separation <120"); ASSERT_OK(dM>120, "M separation <120"); ASSERT_OK(dR>120, "R separation <120");

  Serial.print("[SUMMARY] UT-LINE-01 -> "); Serial.println(ok? "PASS":"FAIL");
  while(true) delay(250);
}
